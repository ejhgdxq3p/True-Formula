<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>True Formula Rollup Banner Generator</title>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,400;0,700;0,900;1,400&family=Noto+Sans+SC:wght@400;700;900&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --retro-green: #009640;
      --retro-yellow: #FDE700;
      --retro-black: #0F380F;
      --retro-white: #FAFAFA;
      --retro-gray: #8BAC0F;
    }

    body {
      background: #222;
      padding: 20px;
    }

    /* È¢ÑËßàÂÆπÂô® */
    #preview-wrapper {
      width: 100%;
      max-width: 800px;
      margin: 0 auto;
    }

    /* ‰∏ªÁîªÂ∏É - È´òÂ∫¶Áº©Áü≠1/3 */
    #rollup-banner {
      width: 4724px;
      height: 7874px;
      background: var(--retro-green);
      background-image:
        linear-gradient(rgba(253, 231, 0, 0.25) 3px, transparent 3px),
        linear-gradient(90deg, rgba(253, 231, 0, 0.25) 3px, transparent 3px),
        linear-gradient(rgba(253, 231, 0, 0.12) 1.5px, transparent 1.5px),
        linear-gradient(90deg, rgba(253, 231, 0, 0.12) 1.5px, transparent 1.5px);
      background-size: 96px 96px, 96px 96px, 24px 24px, 24px 24px;
      padding: 120px 300px 500px 300px;
      overflow: visible;
      position: relative;
      transform: scale(0.12);
      transform-origin: top left;
    }

    /* retro-border Ê†∑Âºè */
    .retro-border {
      border: 6px solid var(--retro-black);
      box-shadow:
        inset 0 0 0 4px var(--retro-yellow),
        12px 12px 0 0 var(--retro-black);
      background: white;
    }

    /* ËÑâÂÜ≤Âä®Áîª */
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.3; }
    }

    /* ÊéßÂà∂Èù¢Êùø */
    #controls {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1000;
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    #controls button {
      padding: 20px 40px;
      font-size: 18px;
      font-weight: 900;
      background: var(--retro-yellow);
      border: 4px solid var(--retro-black);
      color: var(--retro-black);
      cursor: pointer;
      font-family: 'JetBrains Mono', monospace;
      text-transform: uppercase;
      box-shadow: 4px 4px 0 var(--retro-black);
      transition: all 0.1s;
    }

    #controls button:hover {
      transform: translate(2px, 2px);
      box-shadow: 2px 2px 0 var(--retro-black);
    }

    #controls button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
  </style>
</head>
<body>
  <!-- È¢ÑËßàÂå∫Âüü -->
  <div id="preview-wrapper">
    <div id="rollup-banner">

      <!-- Section 1: Header -->
      <div class="header-section" style="margin-bottom: 40px; position: relative;">
        <!-- Explosion star decorations -->
        <div style="position: absolute; top: -50px; left: 80px; z-index: 100;">
          <svg width="280" height="280">
            <polygon points="140,20 161,105 245,119 182,182 203,266 140,217 77,266 98,182 35,119 119,105" fill="#FDE700" stroke="#0F380F" stroke-width="12"/>
          </svg>
        </div>
        <div style="position: absolute; top: -30px; right: 100px; z-index: 100;">
          <svg width="250" height="250">
            <polygon points="125,14 146,91 216,105 161,161 181,237 125,196 69,237 90,161 35,105 104,91" fill="#FDE700" stroke="#0F380F" stroke-width="12"/>
          </svg>
        </div>

        <!-- Side decorations -->
        <div style="position: absolute; top: 50%; left: -80px; transform: translateY(-50%);">
          <div style="width: 150px; height: 150px; background: #FDE700; border: 12px solid #0F380F; transform: rotate(45deg); box-shadow: 10px 10px 0 #009640;"></div>
        </div>
        <div style="position: absolute; top: 50%; right: -80px; transform: translateY(-50%);">
          <div style="width: 150px; height: 150px; background: #009640; border: 12px solid #FDE700; transform: rotate(45deg); box-shadow: 10px 10px 0 #0F380F;"></div>
        </div>

        <!-- 3D shadow layer -->
        <div style="position: relative; transform: rotate(-0.8deg);">
          <div style="position: absolute; inset: 0; background: #0F380F; transform: translate(40px, 40px);"></div>

          <!-- Main title block -->
          <div style="background: #0F380F; border: 18px solid #FDE700; padding: 120px 100px; text-align: center; position: relative; box-shadow: inset 0 0 0 12px #009640, inset 0 0 0 24px #FDE700;">
            <!-- Pointer decorations -->
            <div style="display: flex; align-items: center; justify-content: center; gap: 80px; flex-wrap: wrap;">
              <svg width="220" height="220">
                <polygon points="30,30 30,190 110,110 190,190 190,30" fill="#FDE700" stroke="#0F380F" stroke-width="14"/>
                <polygon points="110,110 190,30 190,190" fill="#009640" stroke="#0F380F" stroke-width="14"/>
                <circle cx="110" cy="110" r="28" fill="#FDE700"/>
              </svg>

              <h1 style="font-size: 280px; font-weight: 900; color: #FDE700; letter-spacing: 20px; font-family: 'JetBrains Mono', monospace; text-shadow: 12px 12px 0 #009640, 24px 24px 0 rgba(0,0,0,0.4), 0 0 60px rgba(253,231,0,0.4); transform: scaleY(1.18);">
                TRUE FORMULA
              </h1>

              <svg width="220" height="220">
                <polygon points="30,30 30,190 110,110 190,190 190,30" fill="#FDE700" stroke="#0F380F" stroke-width="14"/>
                <polygon points="110,110 190,30 190,190" fill="#009640" stroke="#0F380F" stroke-width="14"/>
                <circle cx="110" cy="110" r="28" fill="#FDE700"/>
              </svg>
            </div>
          </div>
        </div>

        <!-- Divider line -->
        <div style="position: relative; margin: 80px 0 60px 0;">
          <div style="height: 35px; background: #FDE700; box-shadow: 0 15px 0 #0F380F; border: 8px solid #0F380F;"></div>
          <div style="position: absolute; top: -25px; left: 20%; width: 110px; height: 110px; background: #FDE700; border: 10px solid #0F380F; transform: rotate(45deg); box-shadow: 8px 8px 0 #009640;"></div>
          <div style="position: absolute; top: -30px; left: 50%; transform: translateX(-50%); width: 130px; height: 130px; background: #009640; border: 12px solid #FDE700; transform: translateX(-50%) rotate(45deg); box-shadow: 10px 10px 0 #0F380F;"></div>
          <div style="position: absolute; top: -25px; right: 20%; width: 110px; height: 110px; background: #FDE700; border: 10px solid #0F380F; transform: rotate(45deg); box-shadow: 8px 8px 0 #009640;"></div>
        </div>

        <!-- Tagline card -->
        <div class="retro-border" style="text-align: center; padding: 100px; position: relative; transform: rotate(0.5deg);">
          <!-- Corner decorations -->
          <div style="position: absolute; top: -30px; left: -30px; width: 100px; height: 100px; background: #FDE700; border: 10px solid #0F380F; transform: rotate(45deg); z-index: 5;"></div>
          <div style="position: absolute; top: -30px; right: -30px; width: 100px; height: 100px; background: #009640; border: 10px solid #FDE700; transform: rotate(45deg); z-index: 5;"></div>
          <div style="position: absolute; bottom: -30px; left: -30px; width: 100px; height: 100px; background: #009640; border: 10px solid #FDE700; transform: rotate(45deg); z-index: 5;"></div>
          <div style="position: absolute; bottom: -30px; right: -30px; width: 100px; height: 100px; background: #FDE700; border: 10px solid #0F380F; transform: rotate(45deg); z-index: 5;"></div>

          <p style="font-size: 105px; font-style: italic; color: #009640; font-family: 'JetBrains Mono', monospace; font-weight: 800; text-shadow: 2px 2px 0 rgba(15,56,15,0.2);">
            Decode the Noise. Design Your Biology.
          </p>
        </div>
      </div>

      <!-- Section 2: Project Vision -->
      <div class="content-section" style="margin-bottom: 30px; margin-top: -40px; position: relative;">
        <!-- Explosion decoration -->
        <div style="position: absolute; top: -100px; left: 50%; transform: translateX(-50%); z-index: 100;">
          <svg width="240" height="240">
            <polygon points="120,12 138,90 216,102 159,159 177,237 120,192 63,237 81,159 24,102 102,90" fill="#FDE700" stroke="#0F380F" stroke-width="12"/>
          </svg>
        </div>

        <!-- Section title -->
        <div style="position: relative; margin-bottom: 50px; transform: rotate(0.6deg);">
          <div style="position: absolute; left: -120px; top: 50%; transform: translateY(-50%);">
            <svg width="140" height="140">
              <polygon points="20,70 120,20 120,120" fill="#FDE700" stroke="#0F380F" stroke-width="10"/>
            </svg>
          </div>

          <div style="position: absolute; inset: 0; background: #0F380F; transform: translate(30px, 30px);"></div>
          <div style="background: #FDE700; border: 14px solid #0F380F; padding: 70px 100px; position: relative; box-shadow: inset 0 0 0 10px #009640, inset 0 0 0 20px #FDE700;">
            <h2 style="font-size: 130px; font-weight: 900; color: #0F380F; font-family: 'JetBrains Mono', monospace; letter-spacing: 10px; text-shadow: 5px 5px 0 rgba(255,255,255,0.4); transform: scaleY(1.12);">
              01. AI-POWERED SUPPLEMENT PLANNER
            </h2>
          </div>

          <div style="position: absolute; right: -120px; top: 50%; transform: translateY(-50%) scaleX(-1);">
            <svg width="140" height="140">
              <polygon points="20,70 120,20 120,120" fill="#FDE700" stroke="#0F380F" stroke-width="10"/>
            </svg>
          </div>
        </div>

        <!-- Content card -->
        <div class="retro-border" style="padding: 80px; position: relative;">
          <p style="font-size: 88px; line-height: 1.8; color: #009640; font-style: italic; font-family: 'JetBrains Mono', monospace; font-weight: 700;">
            Don't just save videos. True Formula transforms complex content into a <span style="background: #FDE700; padding: 6px 25px; color: #0F380F; border: 8px solid #0F380F; font-weight: 900;">Daily Intake List</span>. It answers three core questions: <span style="background: #009640; color: #FDE700; padding: 6px 25px; border: 8px solid #FDE700; font-weight: 900;">Should I take this? What is the effective dosage? What time exactly?</span>
          </p>
        </div>

        <!-- Divider -->
        <div style="margin: 60px 0; position: relative;">
          <div style="height: 6px; background: rgba(255,255,255,0.4);"></div>
          <div style="position: absolute; top: -15px; left: 50%; transform: translateX(-50%);">
            <svg width="100" height="40">
              <circle cx="50" cy="20" r="18" fill="#FDE700" stroke="#0F380F" stroke-width="6"/>
            </svg>
          </div>
        </div>
      </div>

      <!-- Section 3: Mechanism -->
      <div class="content-section" style="margin-bottom: 30px;">
        <!-- Section title -->
        <div style="position: relative; margin-bottom: 50px;">
          <div style="position: absolute; left: -100px; top: 50%; transform: translateY(-50%);">
            <svg width="110" height="110">
              <polygon points="14,55 97,14 97,97" fill="#FDE700" stroke="#0F380F" stroke-width="8"/>
            </svg>
          </div>

          <div style="position: absolute; inset: 0; background: #0F380F; transform: translate(28px, 28px);"></div>
          <div style="background: #FDE700; border: 14px solid #0F380F; padding: 70px 112px; position: relative; box-shadow: inset 0 0 0 8px #009640;">
            <h2 style="font-size: 150px; font-weight: 900; color: #0F380F; font-family: 'JetBrains Mono', monospace; letter-spacing: 11px; text-shadow: 4px 4px 0 rgba(255,255,255,0.3);">
              02. MECHANISM
            </h2>
          </div>

          <div style="position: absolute; right: -100px; top: 50%; transform: translateY(-50%) scaleX(-1);">
            <svg width="110" height="110">
              <polygon points="14,55 97,14 97,97" fill="#FDE700" stroke="#0F380F" stroke-width="8"/>
            </svg>
          </div>
        </div>

        <!-- List items -->
        <div style="display: flex; flex-direction: column; gap: 40px;">
          <!-- Item 1 -->
          <div style="border: 18px solid #009640; background: white; padding: 80px; position: relative; box-shadow: 25px 25px 0 #0F380F; transform: rotate(-0.4deg);">
            <div style="display: flex; gap: 75px; align-items: start;">
              <div style="width: 150px; height: 150px; background: #FDE700; border: 12px solid #0F380F; flex-shrink: 0; transform: rotate(45deg); box-shadow: 10px 10px 0 #009640;">
              </div>
              <div>
                <h3 style="font-size: 108px; font-weight: 900; color: #0F380F; margin-bottom: 40px; font-family: 'JetBrains Mono', monospace; text-shadow: 5px 5px 0 rgba(253,231,0,0.4); transform: scaleY(1.1);">
                  INPUT:
                </h3>
                <p style="font-size: 78px; line-height: 1.7; color: #009640; font-style: italic; font-family: 'JetBrains Mono', monospace; font-weight: 800;">
                  Short Videos about Supplements & Diet (TikTok / YouTube)
                </p>
              </div>
            </div>
          </div>

          <!-- Item 2 -->
          <div style="border: 18px solid #009640; background: white; padding: 80px; box-shadow: 25px 25px 0 #0F380F; transform: rotate(0.5deg);">
            <div style="display: flex; gap: 75px; align-items: start;">
              <div style="width: 150px; height: 150px; background: #FDE700; border: 12px solid #0F380F; flex-shrink: 0; transform: rotate(45deg); box-shadow: 10px 10px 0 #009640;">
              </div>
              <div>
                <h3 style="font-size: 108px; font-weight: 900; color: #0F380F; margin-bottom: 40px; font-family: 'JetBrains Mono', monospace; text-shadow: 5px 5px 0 rgba(253,231,0,0.4); transform: scaleY(1.1);">
                  PROCESSOR:
                </h3>
                <p style="font-size: 78px; line-height: 1.7; color: #009640; font-style: italic; font-family: 'JetBrains Mono', monospace; font-weight: 800;">
                  <span style="background: #FDE700; padding: 14px 42px; border: 12px solid #0F380F; display: inline-block; transform: rotate(-1.5deg);">DeepSeek R1</span> (Pharmacological Logic) + <span style="background: #FDE700; padding: 14px 42px; border: 12px solid #0F380F; display: inline-block; transform: rotate(1.5deg);">Qwen2-VL</span> (Reading Labels)
                </p>
              </div>
            </div>
          </div>

          <!-- Item 3 -->
          <div style="border: 18px solid #009640; background: white; padding: 80px; box-shadow: 25px 25px 0 #0F380F; transform: rotate(-0.3deg);">
            <div style="display: flex; gap: 75px; align-items: start;">
              <div style="width: 150px; height: 150px; background: #FDE700; border: 12px solid #0F380F; flex-shrink: 0; transform: rotate(45deg); box-shadow: 10px 10px 0 #009640;">
              </div>
              <div>
                <h3 style="font-size: 108px; font-weight: 900; color: #0F380F; margin-bottom: 40px; font-family: 'JetBrains Mono', monospace; text-shadow: 5px 5px 0 rgba(253,231,0,0.4); transform: scaleY(1.1);">
                  OUTPUT:
                </h3>
                <p style="font-size: 78px; line-height: 1.7; color: #009640; font-style: italic; font-family: 'JetBrains Mono', monospace; font-weight: 800;">
                  A <span style="background: #FDE700; padding: 5px 18px; color: #0F380F; border: 8px solid #0F380F;">Ready-to-Use Schedule</span>. Strips away marketing noise to tell you exactly how to arrange your <span style="background: #009640; color: #FDE700; padding: 5px 18px; border: 8px solid #FDE700;">"Bio-Stack"</span> today.
                </p>
              </div>
            </div>
          </div>
        </div>

        <!-- Divider -->
        <div style="margin: 60px 0; position: relative;">
          <div style="height: 6px; background: rgba(255,255,255,0.4);"></div>
          <div style="position: absolute; top: -15px; left: 50%; transform: translateX(-50%);">
            <svg width="100" height="40">
              <circle cx="50" cy="20" r="18" fill="#FDE700" stroke="#0F380F" stroke-width="6"/>
            </svg>
          </div>
        </div>
      </div>

      <!-- Section 4: Capabilities -->
      <div class="content-section" style="margin-bottom: 0px; margin-top: -50px; position: relative;">
        <!-- Top star decoration -->
        <div style="position: absolute; top: -110px; left: 50%; transform: translateX(-50%); z-index: 100;">
          <svg width="260" height="260">
            <polygon points="130,14 152,101 239,116 174,181 195,268 130,217 65,268 87,181 22,116 108,101" fill="#FDE700" stroke="#0F380F" stroke-width="12"/>
          </svg>
        </div>

        <!-- Section title -->
        <div style="position: relative; margin-bottom: 80px; transform: rotate(-0.7deg);">
          <div style="position: absolute; left: -120px; top: 50%; transform: translateY(-50%);">
            <svg width="140" height="140">
              <polygon points="20,70 120,20 120,120" fill="#FDE700" stroke="#0F380F" stroke-width="10"/>
            </svg>
          </div>

          <div style="position: absolute; inset: 0; background: #0F380F; transform: translate(30px, 30px);"></div>
          <div style="background: #FDE700; border: 14px solid #0F380F; padding: 70px 100px; position: relative; box-shadow: inset 0 0 0 10px #009640, inset 0 0 0 20px #FDE700;">
            <h2 style="font-size: 145px; font-weight: 900; color: #0F380F; font-family: 'JetBrains Mono', monospace; letter-spacing: 10px; text-shadow: 5px 5px 0 rgba(255,255,255,0.4); transform: scaleY(1.12);">
              03. CAPABILITIES
            </h2>
          </div>

          <div style="position: absolute; right: -120px; top: 50%; transform: translateY(-50%) scaleX(-1);">
            <svg width="140" height="140">
              <polygon points="20,70 120,20 120,120" fill="#FDE700" stroke="#0F380F" stroke-width="10"/>
            </svg>
          </div>
        </div>

        <!-- Feature blocks -->
        <div style="display: flex; flex-direction: column; gap: 60px;">
          <!-- Feature 1 - Yellow -->
          <div style="border: 16px solid #0F380F; background: #FDE700; padding: 90px; position: relative; box-shadow: 25px 25px 0 #0F380F; transform: rotate(-0.8deg);">
            <!-- Corner explosion -->
            <div style="position: absolute; top: -50px; right: -50px; z-index: 100;">
              <svg width="180" height="180">
                <polygon points="90,8 105,60 158,72 117,113 132,165 90,135 48,165 63,113 22,72 75,60" fill="#009640" stroke="#FDE700" stroke-width="10"/>
              </svg>
            </div>

            <div style="display: flex; gap: 70px; align-items: start;">
              <div style="font-size: 180px; color: #0F380F; font-weight: 900; flex-shrink: 0; text-shadow: 8px 8px 0 rgba(0,150,64,0.6); transform: scaleY(1.3);">&gt;</div>
              <div>
                <h3 style="font-size: 105px; font-weight: 900; color: #0F380F; margin-bottom: 50px; font-family: 'JetBrains Mono', monospace; text-shadow: 5px 5px 0 rgba(255,255,255,0.5); transform: scaleY(1.15);">
                  Ingredient Extraction
                </h3>
                <p style="font-size: 70px; line-height: 1.7; color: #009640; font-style: italic; font-family: 'JetBrains Mono', monospace; font-weight: 800;">
                  Too fast to hear? AI extracts <span style="background: #009640; color: #FDE700; padding: 3px 12px; border: 4px solid #FDE700;">every ingredient and exact dosage</span> from the video into a <span style="background: #009640; color: #FDE700; padding: 3px 12px; border: 4px solid #FDE700;">shopping list</span>.
                </p>
              </div>
            </div>
          </div>

          <!-- Feature 2 - White -->
          <div style="border: 16px solid #0F380F; background: white; padding: 90px; box-shadow: 25px 25px 0 #0F380F; transform: rotate(0.9deg); position: relative;">
            <!-- Left explosion -->
            <div style="position: absolute; top: -50px; left: -50px; z-index: 100;">
              <svg width="180" height="180">
                <polygon points="90,8 105,60 158,72 117,113 132,165 90,135 48,165 63,113 22,72 75,60" fill="#FDE700" stroke="#0F380F" stroke-width="10"/>
              </svg>
            </div>

            <div style="display: flex; gap: 70px; align-items: start;">
              <div style="font-size: 180px; color: #FDE700; font-weight: 900; flex-shrink: 0; text-shadow: 8px 8px 0 #0F380F; transform: scaleY(1.3);">&gt;</div>
              <div>
                <h3 style="font-size: 105px; font-weight: 900; color: #0F380F; margin-bottom: 50px; font-family: 'JetBrains Mono', monospace; transform: scaleY(1.15);">
                  Conflict Alert
                </h3>
                <p style="font-size: 70px; line-height: 1.7; color: #009640; font-style: italic; font-family: 'JetBrains Mono', monospace; font-weight: 800;">
                  Supplements can clash! AI checks your list (e.g., <span style="background: #FDE700; padding: 4px 15px; color: #0F380F; border: 6px solid #0F380F;">Calcium blocks Iron</span>). It warns you in red to avoid side effects.
                </p>
              </div>
            </div>
          </div>

          <!-- Feature 3 - Green -->
          <div style="border: 16px solid #FDE700; background: #009640; padding: 90px; box-shadow: 25px 25px 0 #0F380F; transform: rotate(-0.6deg); position: relative;">
            <!-- Bottom explosion -->
            <div style="position: absolute; bottom: -50px; right: 30%; z-index: 100;">
              <svg width="180" height="180">
                <polygon points="90,8 105,60 158,72 117,113 132,165 90,135 48,165 63,113 22,72 75,60" fill="#FDE700" stroke="#0F380F" stroke-width="10"/>
              </svg>
            </div>

            <div style="display: flex; gap: 70px; align-items: start;">
              <div style="font-size: 180px; color: #FDE700; font-weight: 900; flex-shrink: 0; text-shadow: 8px 8px 0 #0F380F; transform: scaleY(1.3);">&gt;</div>
              <div>
                <h3 style="font-size: 105px; font-weight: 900; color: #FDE700; margin-bottom: 50px; font-family: 'JetBrains Mono', monospace; text-shadow: 6px 6px 0 #0F380F; transform: scaleY(1.15);">
                  Smart Schedule
                </h3>
                <p style="font-size: 70px; line-height: 1.7; color: #FDE700; font-style: italic; font-family: 'JetBrains Mono', monospace; font-weight: 800;">
                  Don't memorize times. The system creates a <span style="background: #FDE700; color: #0F380F; padding: 3px 12px; border: 4px solid #0F380F; font-weight: 900;">Daily Timeline</span>: Energy boosters in the morning, sleep aids at night. Organized perfectly.
                </p>
              </div>
            </div>
          </div>
        </div>

        <!-- Bottom divider -->
        <div style="position: relative; margin: 100px 0 60px 0;">
          <div style="height: 35px; background: #FDE700; box-shadow: 0 15px 0 #0F380F; border: 8px solid #0F380F;"></div>
          <div style="position: absolute; top: -25px; left: 25%; width: 110px; height: 110px; background: #FDE700; border: 10px solid #0F380F; transform: rotate(45deg); box-shadow: 8px 8px 0 #009640;"></div>
          <div style="position: absolute; top: -30px; left: 50%; transform: translateX(-50%); width: 130px; height: 130px; background: #009640; border: 12px solid #FDE700; transform: translateX(-50%) rotate(45deg); box-shadow: 10px 10px 0 #0F380F;"></div>
          <div style="position: absolute; top: -25px; right: 25%; width: 110px; height: 110px; background: #FDE700; border: 10px solid #0F380F; transform: rotate(45deg); box-shadow: 8px 8px 0 #009640;"></div>
        </div>
      </div>


    </div>
  </div>

  <!-- Control Panel -->
  <div id="controls">
    <button id="download-pdf">üìÑ Download PDF</button>
    <button id="download-png">üñºÔ∏è Download PNG</button>
  </div>

  <!-- Libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <script>
    // Wait for fonts to load
    async function waitForFonts() {
      if (document.fonts && document.fonts.ready) {
        await document.fonts.ready;
      }
      await new Promise(resolve => setTimeout(resolve, 500));
    }

    // PDF Export
    document.getElementById('download-pdf').addEventListener('click', async () => {
      const btn = document.getElementById('download-pdf');
      const originalText = btn.textContent;
      btn.textContent = '‚è≥ Loading...';
      btn.disabled = true;

      try {
        await waitForFonts();

        const banner = document.getElementById('rollup-banner');
        const wrapper = document.getElementById('preview-wrapper');

        const originalBannerTransform = banner.style.transform;
        const originalWrapperTransform = wrapper.style.transform;

        banner.style.transform = 'none';
        wrapper.style.transform = 'none';
        wrapper.style.width = 'auto';
        wrapper.style.maxWidth = 'none';

        const originalOverflow = banner.style.overflow;
        banner.style.overflow = 'visible';

        btn.textContent = '‚è≥ Rendering...';

        await new Promise(resolve => setTimeout(resolve, 500));

        const { jsPDF } = window.jspdf;

        btn.textContent = '‚è≥ Generating PDF...';

        const actualHeight = banner.scrollHeight;
        console.log('Actual banner height:', actualHeight);

        const canvas = await html2canvas(banner, {
          scale: 1,
          useCORS: true,
          allowTaint: true,
          backgroundColor: '#009640',
          logging: true,
          width: 4724,
          height: actualHeight,
          x: 0,
          y: 0,
          scrollX: 0,
          scrollY: 0,
          windowWidth: 4724,
          windowHeight: actualHeight + 200,
          foreignObjectRendering: false,
          imageTimeout: 15000,
          onclone: function(clonedDoc) {
            const clonedBanner = clonedDoc.getElementById('rollup-banner');
            if (clonedBanner) {
              clonedBanner.style.overflow = 'visible';
            }
          }
        });

        console.log('Canvas created:', canvas.width, 'x', canvas.height);

        banner.style.transform = originalBannerTransform;
        banner.style.overflow = originalOverflow;
        wrapper.style.transform = originalWrapperTransform;
        wrapper.style.width = '100%';
        wrapper.style.maxWidth = '800px';

        if (canvas.width === 0 || canvas.height === 0) {
          throw new Error('Canvas generation failed, size is 0');
        }

        const imgData = canvas.toDataURL('image/jpeg', 0.95);

        const pdfActual = new jsPDF({
          orientation: 'portrait',
          unit: 'px',
          format: [4724, actualHeight],
          compress: true
        });
        pdfActual.addImage(imgData, 'JPEG', 0, 0, 4724, actualHeight);
        pdfActual.save('TrueFormula_Rollup_EN.pdf');

        btn.textContent = '‚úÖ Downloaded!';
        setTimeout(() => {
          btn.textContent = originalText;
          btn.disabled = false;
        }, 2000);
      } catch (error) {
        console.error('PDF export failed:', error);
        alert('Export failed: ' + error.message + '\nCheck console for details');
        btn.textContent = originalText;
        btn.disabled = false;
      }
    });

    // PNG Export
    document.getElementById('download-png').addEventListener('click', async () => {
      const btn = document.getElementById('download-png');
      const originalText = btn.textContent;
      btn.textContent = '‚è≥ Loading...';
      btn.disabled = true;

      try {
        await waitForFonts();

        const banner = document.getElementById('rollup-banner');
        const wrapper = document.getElementById('preview-wrapper');

        const originalBannerTransform = banner.style.transform;
        const originalWrapperTransform = wrapper.style.transform;

        banner.style.transform = 'none';
        wrapper.style.transform = 'none';
        wrapper.style.width = 'auto';
        wrapper.style.maxWidth = 'none';

        const originalOverflow = banner.style.overflow;
        banner.style.overflow = 'visible';

        btn.textContent = '‚è≥ Rendering...';

        await new Promise(resolve => setTimeout(resolve, 500));

        btn.textContent = '‚è≥ Generating PNG...';

        const actualHeight = banner.scrollHeight;
        console.log('Actual banner height for PNG:', actualHeight);

        const canvas = await html2canvas(banner, {
          scale: 1,
          useCORS: true,
          allowTaint: true,
          backgroundColor: '#009640',
          logging: true,
          width: 4724,
          height: actualHeight,
          x: 0,
          y: 0,
          scrollX: 0,
          scrollY: 0,
          windowWidth: 4724,
          windowHeight: actualHeight + 200,
          foreignObjectRendering: false,
          imageTimeout: 15000,
          onclone: function(clonedDoc) {
            const clonedBanner = clonedDoc.getElementById('rollup-banner');
            if (clonedBanner) {
              clonedBanner.style.overflow = 'visible';
            }
          }
        });

        console.log('Canvas created:', canvas.width, 'x', canvas.height);

        banner.style.transform = originalBannerTransform;
        banner.style.overflow = originalOverflow;
        wrapper.style.transform = originalWrapperTransform;
        wrapper.style.width = '100%';
        wrapper.style.maxWidth = '800px';

        if (canvas.width === 0 || canvas.height === 0) {
          throw new Error('Canvas generation failed, size is 0');
        }

        canvas.toBlob((blob) => {
          if (!blob) {
            throw new Error('Blob generation failed');
          }

          const url = URL.createObjectURL(blob);
          const link = document.createElement('a');
          link.download = `TrueFormula_Rollup_4724x${actualHeight}px_EN.png`;
          link.href = url;
          link.click();
          URL.revokeObjectURL(url);

          btn.textContent = '‚úÖ Downloaded!';
          setTimeout(() => {
            btn.textContent = originalText;
            btn.disabled = false;
          }, 2000);
        }, 'image/png');
      } catch (error) {
        console.error('PNG export failed:', error);
        alert('Export failed: ' + error.message + '\nCheck console for details');
        btn.textContent = originalText;
        btn.disabled = false;
      }
    });
  </script>
</body>
</html>
